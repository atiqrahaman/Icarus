webpackJsonp([18],{233:function(t,e,s){"use strict";function n(){u.call(this),this.fConfirmCallback=null,this.confirmDesc=r.observable(""),this.popupHeading=r.observable(""),this.okButtonText=r.observable(c.i18n("COREWEBCLIENT/ACTION_OK")),this.cancelButtonText=r.observable(c.i18n("COREWEBCLIENT/ACTION_CANCEL")),this.shown=!1}var o=s(2),i=s(1),r=s(46),c=s(43),u=s(188);o.extendOwn(n.prototype,u.prototype),n.prototype.PopupTemplate="CoreWebclient_ConfirmPopup",n.prototype.onOpen=function(t,e,s,n,o){this.confirmDesc(t),this.popupHeading(s||""),this.okButtonText(n||c.i18n("COREWEBCLIENT/ACTION_OK")),this.cancelButtonText(o||c.i18n("COREWEBCLIENT/ACTION_CANCEL")),i.isFunction(e)&&(this.fConfirmCallback=e),this.shown=!0},n.prototype.onHide=function(){this.shown=!1},n.prototype.onEnterHandler=function(){this.yesClick()},n.prototype.yesClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(!0),this.closePopup()},n.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closePopup()},t.exports=new n},351:function(t,e,s){"use strict";t.exports=function(t){var e=s(2),n=s(43),o=s(179),i=s(42),r=s(352),c=o.getUserRole()===Enums.UserRole.SuperAdmin,u=o.getUserRole()===Enums.UserRole.NormalUser;return r.init(t),i.isModuleAvailable(r.ServerModuleName)?c?{start:function(t){t.run("AdminPanelWebclient","registerAdminPanelTab",[function(t){s.e(1,function(){t(s(353))})},r.HashModuleName+"-accounts",n.i18n("STANDARDAUTHWEBCLIENT/ADMIN_PANEL_TAB_LABEL")])}}:u?{start:function(t){o.subscribeEvent("ReceiveAjaxResponse::after",function(t){t.Request.Module===r.ServerModuleName&&"GetUserAccounts"===t.Request.Method&&(r.userAccountsCount(e.isArray(t.Response.Result)?t.Response.Result.length:0),r.accountsEmails(e.isArray(t.Response.Result)?e.map(t.Response.Result,function(t){return t.login||""}):0))}),t.run("SettingsWebclient","registerSettingsTab",[function(){return s(353)},r.HashModuleName+"-accounts",n.i18n("STANDARDAUTHWEBCLIENT/USER_SETTINGS_TAB_LABEL")])}}:null:null}},352:function(t,e,s){"use strict";var n=s(46),o=s(179);t.exports={ServerModuleName:"StandardAuth",HashModuleName:"standardauth",userAccountsCount:n.observable(0),accountsEmails:n.observableArray([]),init:function(t){o.registerUserAccountsCount(this.userAccountsCount),o.registerAccountsWithPass(this.accountsEmails)}}},353:function(t,e,s){"use strict";function n(){o.call(this,C.ServerModuleName),this.sFakePass="xxxxxxxx",this.iUserId=l.getUserId(),this.accounts=c.observableArray([]),this.currentAccountId=c.observable(0),this.createAccountHeading=c.computed(function(){return 0===this.accounts().length?u.i18n("STANDARDAUTHWEBCLIENT/HEADING_CREATE_FIRST_ACCOUNT"):0===this.currentAccountId()?u.i18n("STANDARDAUTHWEBCLIENT/HEADING_CREATE_NEW_ACCOUNT"):u.i18n("STANDARDAUTHWEBCLIENT/HEADING_EDIT_NEW_ACCOUNT")},this),this.updateButtonText=c.computed(function(){return 0===this.currentAccountId()?u.i18n("STANDARDAUTHWEBCLIENT/ACTION_CREATE"):u.i18n("STANDARDAUTHWEBCLIENT/ACTION_UPDATE")},this),this.updateProgressButtonText=c.computed(function(){return 0===this.currentAccountId()?u.i18n("STANDARDAUTHWEBCLIENT/ACTION_CREATE_IN_PROGRESS"):u.i18n("STANDARDAUTHWEBCLIENT/ACTION_UPDATE_IN_PROGRESS")},this),this.sUserPublicId="",this.login=c.observable(""),this.loginFocus=c.observable(!1),this.pass=c.observable(""),this.passFocus=c.observable(!1),this.confirmPass=c.observable(""),this.confirmPassFocus=c.observable(!1),this.visibleCreateForm=c.observable(!1),this.isCreating=c.observable(!1),l.getUserRole()===Enums.UserRole.NormalUser&&(this.requestAccounts(),c.computed(function(){this.visible(this.accounts().length>0)},this)),l.subscribeEvent(p.ServerModuleName+"::CreateUserAuthAccount",i.bind(function(t){T.send("CreateAuthenticatedUserAccount",{Login:t.Login,Password:t.Password},i.bind(function(e){e.Result?(this.accounts.push({id:e.Result.EntityId,login:t.Login}),l.broadcastEvent("OpenSettingTab",{Name:this.SettingsTabName})):h.showErrorByCode(e)},this))},this)),l.subscribeEvent("ReceiveAjaxResponse::after",i.bind(function(t){"AdminPanelWebclient"===t.Request.Module&&"GetEntity"===t.Request.Method&&t.Response.Result&&t.Request.Parameters.Id===this.iUserId&&(this.sUserPublicId=t.Response.Result.PublicId,this.login(this.sUserPublicId))},this)),l.broadcastEvent("StandardAuthWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var o,i=s(2),r=s(1),c=s(46),u=s(43),a=s(186),A=s(233),h=s(181),l=s(179),E=s(42),d=s(182),C=s(45),T=s(354),p=s(352);o=l.getUserRole()===Enums.UserRole.SuperAdmin?E.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"):E.run("SettingsWebclient","getAbstractSettingsFormViewClass"),i.extendOwn(n.prototype,o.prototype),n.prototype.ViewTemplate="StandardAuthWebclient_StandardAccountsSettingsFormView",n.prototype.ViewConstructorName="CStandardAccountsSettingsFormView",n.prototype.onShow=function(){this.requestAccounts(),l.broadcastEvent("CStandardAccountsSettingsFormView::onShow::after",{Name:this.ViewConstructorName,View:this})},n.prototype.onRouteChild=n.prototype.onShow,n.prototype.requestAccounts=function(){T.send("GetUserAccounts",{UserId:this.iUserId},function(t){i.isArray(t.Result)?this.accounts(t.Result):(h.showErrorByCode(t),this.accounts([])),0===this.accounts().length?this.openEditAccountForm(0):this.openEditAccountForm(this.accounts()[0].id)},this)},n.prototype.setAccessLevel=function(t,e){this.visible("User"===t),this.iUserId!==e&&(this.accounts([]),this.hideEditAccountForm(),this.iUserId=e||-1,this.sUserPublicId="")},n.prototype.confirmAccountDeleting=function(t,e){a.showPopup(A,[u.i18n("STANDARDAUTHWEBCLIENT/CONFIRM_DELETE_ACCOUNT"),i.bind(this.deleteAccount,this,t),e])},n.prototype.deleteAccount=function(t,e){e&&T.send("DeleteAccount",{AccountId:t},function(t){t.Result?d.showReport(u.i18n("STANDARDAUTHWEBCLIENT/REPORT_DELETE_ACCOUNT")):h.showErrorByCode(t,u.i18n("STANDARDAUTHWEBCLIENT/ERROR_DELETE_ACCOUNT")),this.requestAccounts()},this)},n.prototype.openEditAccountForm=function(t){var e=i.find(this.accounts(),function(e){return e.id===t});e?(this.currentAccountId(t),this.login(e.login),this.pass(this.sFakePass),this.passFocus(!0),this.confirmPass("")):(this.currentAccountId(0),this.login(this.sUserPublicId),this.loginFocus(!0),this.pass(""),this.confirmPass("")),this.visibleCreateForm(!0)},n.prototype.saveAccount=function(){var t=r.trim(this.login()),e=r.trim(this.pass());""===t?this.loginFocus(!0):""===e||e===this.sFakePass?this.passFocus(!0):e!==r.trim(this.confirmPass())?(d.showError(u.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")),this.confirmPassFocus(!0)):0===this.currentAccountId()?T.send("CreateAuthenticatedUserAccount",{Login:t,Password:e},function(t){t.Result?(d.showReport(u.i18n("STANDARDAUTHWEBCLIENT/REPORT_CREATE_ACCOUNT")),this.hideEditAccountForm(),this.requestAccounts()):h.showErrorByCode(t,u.i18n("STANDARDAUTHWEBCLIENT/ERROR_CREATE_ACCOUNT"))},this):T.send("UpdateAccount",{AccountId:this.currentAccountId(),Password:e},function(t){t.Result?(d.showReport(u.i18n("STANDARDAUTHWEBCLIENT/REPORT_UPDATE_ACCOUNT")),this.hideEditAccountForm()):h.showErrorByCode(t,u.i18n("STANDARDAUTHWEBCLIENT/ERROR_UPDATE_ACCOUNT")),this.requestAccounts()},this)},n.prototype.hideEditAccountForm=function(){this.currentAccountId(0),this.visibleCreateForm(!1)},t.exports=new n},354:function(t,e,s){"use strict";var n=s(185),o=s(352);t.exports={send:function(t,e,s,i){n.send(o.ServerModuleName,t,e,s,i)}}}});